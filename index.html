<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Overworld Slide Puzzle</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="puzzle.css" />
</head>
<body>
  <div class="toolbar">
    <div class="toolbar-left">
      <button id="resetBtn" class="btn">Reset</button>
      <button id="shuffleBtn" class="btn">Shuffle</button>
      <button id="settingsBtn" class="btn">Edit Board</button>
      <button id="challengeBtn" class="btn">New Challenge</button>
      <button id="giveUpBtn" class="btn" style="display: none;">Give Up</button>
    </div>
    <div class="toolbar-right">
      <button id="displayBtn" class="btn btn-icon" aria-label="Display settings" title="Display settings">⚙</button>
      <button id="helpBtn" class="btn btn-icon" aria-label="Help" title="Show controls">?</button>
    </div>
  </div>
  <div class="game-container">
    <div id="board" tabindex="0" aria-label="Slide puzzle board"></div>
    <div class="challenge-info" id="challengeInfo" style="display: none;">
      <div class="challenge-info-title">Challenge</div>
      <div class="challenge-info-row">Seed: <span id="challengeSeedDisplay"></span></div>
      <div class="challenge-info-row">Shuffling steps: <span id="challengeStepsDisplay"></span></div>
      <div class="challenge-stats-container">
        <div class="challenge-stat-group">
          <div class="challenge-stat-label">Move Count</div>
          <div id="challengeMovesDisplay" class="challenge-stat-value">0</div>
        </div>
        <div class="challenge-stat-group">
          <div class="challenge-stat-label">Timer</div>
          <div class="challenge-timer-row">
            <div id="challengeTimerDisplay" class="challenge-stat-value" style="cursor: pointer;">0:00</div>
            <button id="timerShowBtn" class="btn" style="display: none;">Show</button>
            <button id="timerToggleBtn" class="btn-timer-toggle" aria-label="Pause timer" title="Pause">⏸</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Help Dialog -->
  <div id="helpDialog" class="dialog-overlay" style="display: none;">
    <div class="dialog">
      <h2>Controls</h2>
      <div class="dialog-content">
        <div class="help-section">
          <h3>Keyboard</h3>
          <p><span class="kbd">Space</span> Switch selected gap</p>
          <p><span class="kbd">←</span><span class="kbd">→</span><span class="kbd">↑</span><span class="kbd">↓</span> or <span class="kbd">W</span><span class="kbd">A</span><span class="kbd">S</span><span class="kbd">D</span> Slide a piece into the selected gap</p>
        </div>
        <div class="help-section">
          <h3>Mouse Click</h3>
          <p>Click a piece to move it into an adjacent gap</p>
          <p>Click a gap to select it</p>
        </div>
        <div class="help-section">
          <h3>Mouse Swipe</h3>
          <p>Swipe a piece or gap to move in that direction</p>
        </div>
        <div class="help-section">
          <h3>Mouse Drag</h3>
          <p>Drag a piece over gaps or drag a gap over pieces to move continuously</p>
        </div>
        <div class="help-note">
          <p><strong>Note:</strong> Large 2×2 pieces move only if both gaps line up on their path. Adjacent gaps can be swapped.</p>
          <p><strong>Wrapping:</strong> When horizontal or vertical wrapping is enabled, pieces can move off one edge of the board and appear on the opposite edge, creating a toroidal topology.</p>
        </div>
      </div>
      <div class="dialog-buttons">
        <button id="helpCloseBtn" class="btn btn-primary">Got it</button>
      </div>
    </div>
  </div>

  <!-- Settings Dialog -->
  <div id="settingsDialog" class="dialog-overlay" style="display: none;">
    <div class="dialog">
      <h2>Board Settings</h2>
      <div class="dialog-content">
        <div class="form-group">
          <label for="settingsBoardSelect">Board Shape:</label>
          <div class="board-select-row">
            <select id="settingsBoardSelect" class="board-select">
              <option value="default">Default (8×8)</option>
              <option value="horizontal">Horizontal (16×8)</option>
              <option value="vertical">Vertical (8×16)</option>
            </select>
            <button id="settingsApplyBtn" class="btn btn-primary">Apply</button>
          </div>
        </div>
        <div class="settings-warning">
          <strong>Note:</strong> Changing the board shape will reset the puzzle to its solved state.
        </div>
        <div class="form-group">
          <label>Gap Positions:</label>
          <div class="gap-control-buttons">
            <button type="button" id="resetGapsBtn" class="btn">Reset Gaps</button>
            <button type="button" id="randomizeGapsBtn" class="btn">Randomize Gaps</button>
          </div>
        </div>
        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" id="wrapHorizontalCheckbox" />
            <span>Horizontal wrapping</span>
          </label>
        </div>
        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" id="wrapVerticalCheckbox" />
            <span>Vertical wrapping</span>
          </label>
        </div>
        <div class="settings-warning">
          <strong>Note:</strong> Disabling wrapping while a large piece is wrapped around the board will reset the puzzle to its solved state.
        </div>
      </div>
      <div class="dialog-buttons">
        <button id="settingsCancelBtn" class="btn btn-primary">Close</button>
      </div>
    </div>
  </div>

  <!-- Display Settings Dialog -->
  <div id="displayDialog" class="dialog-overlay" style="display: none;">
    <div class="dialog">
      <h2>Display Settings</h2>
      <div class="dialog-content">
        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" id="darkModeCheckbox" />
            <span>Dark theme</span>
          </label>
        </div>
        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" id="challengeAboveCheckbox" />
            <span>Challenge box above board</span>
          </label>
        </div>
        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" id="autoScaleCheckbox" />
            <span>Auto-scale to fit screen</span>
          </label>
        </div>
        <div class="form-group">
          <label for="boardSizeSlider">Board size: <span id="boardSizeValue">100%</span></label>
          <input type="range" id="boardSizeSlider" min="10" max="200" step="10" value="100" />
        </div>
      </div>
      <div class="dialog-buttons">
        <button id="displayCloseBtn" class="btn btn-primary">Close</button>
      </div>
    </div>
  </div>

  <!-- Challenge Dialog -->
  <div id="challengeDialog" class="dialog-overlay" style="display: none;">
    <div class="dialog">
      <h2>New Challenge</h2>
      <div class="dialog-content">
        <div class="form-group">
          <label for="challengeBoardSelect">Board:</label>
          <select id="challengeBoardSelect" class="board-select">
            <option value="default">Default (8×8)</option>
            <option value="horizontal">Horizontal (16×8)</option>
            <option value="vertical">Vertical (8×16)</option>
          </select>
        </div>
        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" id="randomizeGapsCheckbox" />
            <span>Randomize gaps</span>
          </label>
        </div>
        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" id="challengeWrapHorizontalCheckbox" />
            <span>Horizontal wrapping</span>
          </label>
        </div>
        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" id="challengeWrapVerticalCheckbox" />
            <span>Vertical wrapping</span>
          </label>
        </div>
        <div class="form-group">
          <label for="seedInput">Seed (leave empty for random):</label>
          <div class="seed-input-group">
            <input type="number" id="seedInput" placeholder="Enter a number" min="0" />
            <button type="button" id="dailyChallengeBtn" class="btn btn-primary">Daily Challenge</button>
          </div>
        </div>
        <div class="form-group">
          <label for="stepsInput">Number of shuffling steps (difficulty):</label>
          <input type="number" id="stepsInput" value="250" min="1" max="10000" />
          <div class="difficulty-presets">
            <button type="button" class="preset-btn" data-steps="50">Easy (50)</button>
            <button type="button" class="preset-btn" data-steps="250">Normal (250)</button>
            <button type="button" class="preset-btn" data-steps="1000">Hard (1000)</button>
            <button type="button" class="preset-btn" data-steps="10000">Very Hard (10000)</button>
          </div>
        </div>
      </div>
      <div class="dialog-buttons">
        <button id="challengeStartBtn" class="btn btn-primary">Start Challenge</button>
        <button id="challengeCancelBtn" class="btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Congratulations Dialog -->
  <div id="congratsDialog" class="dialog-overlay" style="display: none;">
    <div class="dialog">
      <h2>Congratulations!</h2>
      <div class="dialog-content">
        <p id="congratsMessage" style="text-align: center; font-size: 1.1rem; margin: 20px 0;"></p>
      </div>
      <div class="dialog-buttons">
        <button id="congratsOkBtn" class="btn btn-primary">OK</button>
      </div>
    </div>
  </div>

  <script src="puzzle.js"></script>
</body>
</html>